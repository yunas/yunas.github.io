function getPostsAndTweets(){dataTwitterHandle=$(".modal").data("handle"),$(".company-tweets ul").tweet({join_text:"auto",username:dataTwitterHandle,auto_join_text_default:"",count:3,loading_text:"loading...",template:"<span class='screen-name'>{screen_name} <a class='handle' href='http://twitter.com/{name}'>@{name}</a></span><span class='time'>{tweet_relative_time}</span><p class='status'>{text}"}),dataSlug=$(".modal").data("slug"),$.ajax({type:"GET",url:"posts.JSON",dataType:"json",success:function(e){$.each(e.posts,function(e,t){$(".company-blog ul").append('<li class="article"><h3><a href="'+t.url+'">'+t.title+'</a></h3><span class="posted">Posted on '+t.date+'</span><p class="extract">'+t.excerpt+"</p></li>")})}})}$(function(){function y(e){function r(e){$(".video-wrap").addClass("remove-overlay")}var t=$f(e),n=document.getElementById("play-video");t.addEvent("play",r),n.addEventListener("click",function(){t.api("play"),r()}),n.addEventListener("touchstart",function(){t.api("play"),r()})}function w(e){var t={};return t.root=$(".companies"),t.wrap=t.root.find(".companies-wrap"),t.blocks=t.root.find(".block"),t.numBlocks=t.blocks.size(),t.blockWidth=100/(t.numBlocks+2),t.wrapWidth=30*(t.numBlocks+2),t.firstBlock=t.blocks.eq(0),t.lastBlock=t.blocks.eq(t.numBlocks-1),t.firstClone=t.firstBlock.clone(),t.lastClone=t.lastBlock.clone(),e=="left"?(t.blockWidth=100/t.numBlocks,t.wrapWidth=30*t.numBlocks,t.firstBlock=t.blocks.eq(t.numBlocks-3),t.lastBlock=t.blocks.eq(t.numBlocks-1),t.firstClone=t.firstBlock.clone(),t.lastClone=t.lastBlock.clone()):e=="right"&&(t.blockWidth=100/t.numBlocks,t.wrapWidth=30*t.numBlocks,t.firstBlock=t.blocks.eq(0),t.lastBlock=t.blocks.eq(2),t.firstClone=t.firstBlock.clone(),t.lastClone=t.lastBlock.clone()),t}function E(){var e=w(null);e.wrap.prepend(e.lastClone),e.wrap.append(e.firstClone),e.root.css({width:e.wrapWidth+"%"}),$(".companies .block").css({width:e.blockWidth-.1+"%"}),T()}function S(){var e=Modernizr.csstransitions?500:1,t=w("left");$(".block-in-focus:last").removeClass("block-in-focus"),$(".block-in-focus:first").prev().addClass("block-in-focus"),t.wrap.css({"margin-left":t.blockWidth*1+"%"}),setTimeout(function(){t.lastBlock.remove(),t.firstClone.removeClass("block-in-focus"),t.wrap.prepend(t.firstClone),t.wrap.css({"margin-left":0,"transition-duration":"0s"})},e),setTimeout(function(){t.wrap.css({"transition-duration":"500ms"}),b=!0},600)}function x(){var e=Modernizr.csstransitions?500:1,t=w("right");$(".block-in-focus:first").removeClass("block-in-focus"),$(".block-in-focus:last").next().addClass("block-in-focus"),t.wrap.css({"margin-left":t.blockWidth*-1+"%"}),setTimeout(function(){t.firstBlock.remove(),t.lastClone.removeClass("block-in-focus"),t.wrap.append(t.lastClone),t.wrap.css({"margin-left":0,"transition-duration":"0s"})},e),setTimeout(function(){t.wrap.css({"transition-duration":"500ms"}),b=!0},600)}function T(){function t(e){return e%1===0}var e=w(null);e.midpoint=e.numBlocks/2,e.blocks.eq(2).addClass("block-in-focus"),e.blocks.eq(3).addClass("block-in-focus")}function L(e){function n(){$(".ui-dialog").touchwipe({preventDefaultEvents:!1});var t=$('<div style="display:none;" class="modal-loading has-modal"></div>').appendTo("body");t.dialog({beforeClose:function(e,n){return $("body").removeClass("dialog-open"),window.location.hash="#companies",setTimeout(function(){t.remove()},500),!1},close:function(e,t){$("body").removeClass("dialog-open")},draggable:!1,open:function(e,t){$(".ui-dialog, .ui-dialog-content").attr("style",""),$("body").addClass("dialog-open")},resizable:!1,modal:!0}),t.load(e+" .modal",{},function(e,n,r){t.removeClass("modal-loading"),$(".ui-dialog button").blur(),getPostsAndTweets()})}var t=$('div[data-id="companies"]');m(t),$(".has-modal").length?($(".dialog-open").removeClass("dialog-open"),setTimeout(function(){$(".has-modal").dialog("destroy").remove(),n()},500)):n()}var e=$("body").hasClass("individual-company")?!0:!1;window.pageLoaded=!1;var t=function(){var e,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");while(n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",r[0]);return t>4?t:e}(),n=navigator.userAgent.indexOf("Chrome")>-1,r=navigator.userAgent.indexOf("MSIE")>-1,s=navigator.userAgent.indexOf("Firefox")>-1,o=navigator.userAgent.indexOf("Safari")>-1,u=navigator.userAgent.indexOf("Presto")>-1;n&&o&&(o=!1),o&&$("body").addClass("is-safari");if(!e){var a=function(){$(".screen").each(function(e,t){var n=$(t),r=$(window).height(),i=n.children(".inner");n.css({height:r})})},f=function(){setTimeout(function(){$(".screen").each(function(e,t){var n=$(t),r=n.children(".inner"),i=0;r.children().each(function(){i+=$(this).outerHeight(!0)}),innerMargin=i/2,r.css({height:i,marginTop:0-innerMargin})})},2)};f(),a(),$(window).load(function(){f()}),$(window).resize(function(){a(),f()}),$(window).bind("orientationchange",function(){a(),f()})}if(!e){var l={};l.numberOfScreens=$(".screen").size()-1,l.currentScreen,l.screenPosition,l.url,l.lastScroll=0,l.lastScrollPos=0;var c=function(){return $(".screen:in-viewport")},h=function(e,t){var n=c(),r="";for(i=0;i<n.length;i++)$(n[i]).attr("data-index")==="first"&&document.getElementById("crest").play(),r+="reached-"+$(n[i]).attr("data-index")+" ";window.location.hash=n.attr("data-id"),$("body").removeClass("reached-first reached-second reached-third reached-fourth reached-fifth reached-sixth reached-seventh"),$("body").addClass(r),$(".active-screen").removeClass("active-screen"),n.addClass("active-screen")},p=$.throttle(200,!0,h),d=function(e,t){var n,r;t=="down"?e.length>1?(r=e[1],n=$(r).data("id")):n=e.data("id"):n=e.data("id"),n="#"+n,$("nav ul li a").each(function(){$(this).attr("href")==n?$(this).addClass("nav-active"):$(this).removeClass("nav-active")})},v=function(e){e=typeof e!="undefined"?e:"nav-active",$("."+e).removeClass(e)},m=function(e,t){};$(window).bind("hashchange",function(e){l.url=$.param.fragment(),l.url&&(newScreen=$('[data-id="'+l.url+'"]'),l.url.indexOf("/")!==-1?L(l.url):$(".has-modal").length&&($(".dialog-open").removeClass("dialog-open"),setTimeout(function(){$(".has-modal").dialog("destroy").remove()},500)))}),$(window).trigger("hashchange"),$("body").on("mousewheel",function(e,n,r,i){if(window.pageLoaded||t==8)$("body").hasClass("dialog-open")||p(n)}),$(window).on("load",function(){if(window.location.hash){var e=window.location.hash.replace("#","");window.location.hash.indexOf("/")===-1?($(window).scrollTop($('[data-id="'+e+'"]').offset().top),p(0)):$(window).scrollTop($(".screen-6").offset().top)}}),$(window).scroll(function(){var e=$(this).scrollTop(),t;e>l.lastScrollPos?t="down":t="up",d($(".screen:in-viewport"),t),l.lastScrollPos=e})}var g=function(){function t(){e.buffer.drawImage(e.video,0,0);var t=e.buffer.getImageData(0,0,e.width,e.height),n=t.data,r=e.buffer.getImageData(0,e.height,e.width,e.height).data;for(var i=3,s=n.length;i<s;i+=4)n[i]=r[i-1];e.output.putImageData(t,0,0,0,0,e.width,e.height)}var e={};e.outputCanvas=document.getElementById("output"),e.output=e.outputCanvas.getContext("2d"),e.bufferCanvas=document.getElementById("buffer"),e.buffer=e.bufferCanvas.getContext("2d"),e.video=document.getElementById("crest"),e.width=e.outputCanvas.width,e.height=e.outputCanvas.height,e.interval,e.video.addEventListener("play",function(){clearInterval(e.interval),e.interval=setInterval(t,40)},!1)};$(window).load(function(){if(!o){var e=Modernizr.csstransitions?1800:0;setTimeout(function(){document.getElementById("crest").play()},e),g()}}),!Modernizr.touch&&!o&&($(".video-wrap").css({transform:"perspective(400px) scale(0.7) rotateX(45deg)"}),$(window).scroll(function(){var e={};e.video=$(".video-wrap"),e.s2Height=$(".screen-2").height(),e.offset=$(".screen-2").offset().top,e.scrolled=$(document).scrollTop(),e.diff=e.offset-e.scrolled,e.scale=(600-e.diff)/600,e.opacity=(600-e.diff)/600,e.angle=e.diff/4,e.canFire=!0,e.scrolled>e.offset-e.s2Height*.08&&e.canFire&&(e.canFire=!1),e.scale>=.7?e.scale<1?e.video.css({transform:"perspective(400px) scale("+e.scale+")  rotateX("+e.angle+"deg)"}):e.video.css({transform:"none"}):e.video.css({transform:"perspective(400px) scale(0.7) rotateX(45deg)"})})),Modernizr.touch&&$(document).on("click",".overlay",function(e){$(".overlay").remove()}),window.addEventListener("load",function(){$f(document.getElementById("fcv")).addEvent("ready",y)}),$(".slide").css({width:$(window).width(),height:$(window).height()}),$(window).resize(function(){$(".slide").css({width:$(window).width(),height:$(window).height()})}),$(".location-gallery").flexslider({animationSpeed:1e3,directionNav:!1,slideshowSpeed:99999,slideshow:!1,start:function(e){e.pause()}}),$(window).scroll(function(){var e={};e.s3=$(".screen-3"),e.offset=e.s3.offset().top,e.s3height=e.s3.height(),e.scrolled=$(document).scrollTop(),e.canFire=!0,e.scrolled>e.offset-e.s3height*.08&&e.canFire&&(e.canFire=!1)}),$(document).on("click",".slide-content",function(e){$(".location-gallery").flexslider("next"),e.preventDefault()}),$(document).on("keydown",function(e){e.keyCode==37&&e.preventDefault(),e.keyCode==39&&e.preventDefault()}),Modernizr.touch||($(".desk-image").css({transform:"translateX(-400%)"}),$(".plus").css({transform:"translateX(-300%)"}),$(".month-image").css({transform:"translateY(300%)"}),$(".cost-image").css({transform:"translateX(400%)"}),$(".equals").css({transform:"translateY(300%)"}),$(".screen-5 .btn").css({transform:"translateY(50%)","transition-duration":"0s"}),$(window).scroll(function(){var e=new Object;e.s=$(".screen-5"),e.offset=e.s.offset().top,e.s5h=e.s.height(),e.scrolled=$(document).scrollTop(),e.diff=e.offset-e.scrolled,e.deskTranslate=e.diff/-3+3,e.plusTranslate=e.diff/-4,e.monthTranslate=e.diff/4-5,e.equalsTranslate=e.diff/4,e.costTranslate=e.diff/3,e.btnTranslate=e.diff*2,e.canFire=!0,e.scrolled>=e.offset&&e.canFire&&e.canFire==0,e.deskTranslate<=0&&$(".desk-image").css({transform:"translateX("+e.deskTranslate+"%)"}),e.plusTranslate<=0&&$(".plus").css({transform:"translateX("+e.plusTranslate+"%)"}),e.monthTranslate>=0&&$(".month-image").css({transform:"translateY("+e.monthTranslate+"%)"}),e.equalsTranslate>=0&&$(".equals").css({transform:"translateX("+e.equalsTranslate+"%)"}),e.costTranslate>=0&&$(".cost-image").css({transform:"translateX("+e.costTranslate+"%)"}),e.btnTranslate>=0&&$(".screen-5 .btn").css({transform:"translateY("+e.btnTranslate+"%)","transition-duration":"0s"}),e.diff<=0&&$(".desk-image, .plus, .month-image, .equals, .cost-image, .screen-5 .btn").attr("style","")}),$(document).on("mouseenter",".reached-fifth .cost-wrap > div",function(e){var t=$(this),n=t.attr("class");$("body").removeClass("desk-hovered month-and-signs-hovered cost-hovered").addClass(n+"-hovered")}),$(document).on("mouseleave",".reached-fifth .cost-wrap > div",function(e){$("body").removeClass("desk-hovered month-and-signs-hovered cost-hovered")}));var b=!0;E();var N=$.debounce(200,!0,S),C=$.debounce(200,!0,x);$(document).keydown(function(e){$(".screen-6").hasClass("active-screen")&&(e.keyCode==37&&b===!0&&(b=!1,N(),$(".keypress .left").addClass("key-active"),e.preventDefault()),e.keyCode==39&&b===!0&&(b=!1,C(),$(".keypress .right").addClass("key-active"),e.preventDefault()))}),$(".screen-6").touchwipe({wipeRight:function(){!$("body").hasClass("dialog-open")&&$(".screen-6").hasClass("active-screen")&&(N(),$(".keypress .left").addClass("key-active"),setTimeout(function(){$(".keypress .left").removeClass("key-active")},600))},wipeLeft:function(){!$("body").hasClass("dialog-open")&&$(".screen-6").hasClass("active-screen")&&(C(),$(".keypress .right").addClass("key-active"),setTimeout(function(){$(".keypress .right").removeClass("key-active")},600))}}),$(document).keyup(function(e){$(".screen-6").hasClass("active-screen")&&$(".key-active").removeClass("key-active")}),$(document).on("click",".load-company-modal",function(e){var t=this.href,n=$(this).attr("href").replace("companies",""),r=window.location.hash;window.location.hash="#companies"+n,e.preventDefault()});var k;$(document).on("click",".load-other-modal",function(e){var t=this.href,n=$(".ui-dialog-content"),r=$(this).attr("data-slug"),i=window.location.hash;window.location.hash="#companies"+r,e.preventDefault()}),$(document).on("click",".back-to-collective .btn",function(e){window.location.hash="#companies",e.preventDefault()});var A=new google.maps.LatLng(40.724478,-73.997619),O=new google.maps.LatLng(40.723763,-73.997695),M,_,D={zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,center:O,scrollwheel:!1,styles:[{stylers:[{lightness:-80},{gamma:.89},{saturation:-100}]}],disableDefaultUI:!0,draggable:!1};_=new google.maps.Map(document.getElementById("map_canvas"),D);var P="images/7/marker.png",H,M;$(window).scroll(function(){var e={};e.s7=$(".screen-7"),e.offset=e.s7.offset().top,e.s7height=e.s7.height(),e.scrolled=$(document).scrollTop(),e.canFire=!0,e.scrolled>e.offset-e.s7height*.08&&e.canFire&&(e.canFire=!1),$("body").hasClass("reached-seventh")&&H!==!0&&(setTimeout(function(){M=new google.maps.Marker({map:_,draggable:!1,animation:google.maps.Animation.DROP,position:A,optimized:!1,flat:!0,zIndex:1e4}),setTimeout(function(){M.setIcon(P)},200)},1400),H=!0)}),$(window).resize(function(){_.setCenter(A)})}),$(function(){$(window).load(function(){$(".preload").css({transform:"translate3d(0,-100%, 0)"});var e=Modernizr.csstransitions?1e3:1;setTimeout(function(){$("body").addClass("animatable"),$(".preload").remove(),pageLoaded=!0},e),setTimeout(function(){$("body").trigger("animationStart")},e*2.2)})});